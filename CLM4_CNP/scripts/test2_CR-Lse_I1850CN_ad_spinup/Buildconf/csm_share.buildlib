#! /bin/csh -f
#===============================================================================
# Purpose:
#     (a) Build csm_share library
#===============================================================================

#--------------------------------------------------------------------
# Filepath: list of source code directories (in order of importance).
#--------------------------------------------------------------------

set comp = "unknown"
if ($USE_ESMF_LIB == 'FALSE') then
  set esmf_wrf_timemgr = $CODEROOT/utils/esmf_wrf_timemgr
  set comp = mct
else
  set esmf_wrf_timemgr = " "
  set comp = esmf
endif 

cat >! Filepath << EOF
$CASEROOT/SourceMods/src.share
$CODEROOT/drv/shr_$comp
$CODEROOT/drv/shr
$CODEROOT/dead_share
$SHAREROOT/shr
$CODEROOT/utils/timing
$esmf_wrf_timemgr
EOF

set libdir = $EXEROOT/csm_share; cd $libdir

#------------------------------------------------------------------------------
# run make
#------------------------------------------------------------------------------

## Set up multiple component instances

set multiinst_cppdefs = "-DNUM_COMP_INST_ATM=$NINST_ATM -DNUM_COMP_INST_LND=$NINST_LND -DNUM_COMP_INST_OCN=$NINST_OCN -DNUM_COMP_INST_ICE=$NINST_ICE -DNUM_COMP_INST_GLC=$NINST_GLC"

$GMAKE complib -j $GMAKE_J MODEL=csm_share COMPLIB=$libdir/libcsm_share.a  MACFILE=$CASEROOT/Macros.$MACH USER_CPPDEFS="$multiinst_cppdefs" -f $CASETOOLS/Makefile   || exit 2

#------------------------------------------------------------------------------
# copy the library and modules 
#------------------------------------------------------------------------------

cp -p -f libcsm_share.a $LIBROOT/
cp -p -f *.mod $LIBROOT/include/

exit 0

#==============================================================================
# end of script
#==============================================================================
